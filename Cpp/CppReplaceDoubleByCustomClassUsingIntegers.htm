<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
  <title>Will it pay off to replace the use of doubles by a custom class using integers?</title>
  <meta name="description" content="C++ Will it pay off to replace the use of doubles by a custom class using integers?"/>
  <meta name="keywords" content="C++ FAQ Will it pay off to replace the use of doubles by a custom class using integers? code snippet"/>
  <link rel="stylesheet" href="Richelbilderbeek.css" type="text/css"/>
</head>
<!-- End of head, start of body -->
<body>
<p><a href="index.htm">Go back to Richel Bilderbeek's homepage</a>.</p>
<p><a href="Cpp.htm">Go back to Richel Bilderbeek's C++ page</a>.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<!-- Page header -->
<h1>(<a href="Cpp.htm">C++</a>) <a href="CppReplaceDoubleByCustomClassUsingIntegers.htm">Will it pay off to replace the use of doubles by a custom class using integers?</a></h1>
<p>&nbsp;</p>
<p><a href="CppReplaceDoubleByCustomClassUsingIntegers.htm">Will it pay off to replace the use of doubles by a custom class using integers?</a> is an
<a href="CppFaq.htm">FAQ</a> about the expected gains of replacing floating point (that is <a href="CppDouble.htm">double</a>) calculations by 
using a custom <a href="CppClass.htm">class</a>
that uses <a href="CppInt.htm">integers</a> to emulate a floating point.</p>
<p>&nbsp;</p>
<p>I posted the original question <a href="http://www.cplusplus.com/forum/general/103139">here</a>.</p>
<p>&nbsp;</p>
<p>Thanks to <a href="http://www.cplusplus.com/user/MiiNiPaa">MiiNiPaa</a> for his answer:</p>
<p>&nbsp;</p>
<!-- start of code -->
<table summary="Answer by MiiNiPaa" border = "1"><tr><td><code>
No<br/>
<br/>
Fixed point class probably will: for example it is more profitable to store money as integer cents (1250) as opposed to fraction dollars (12.5)<br/>
<br/>
Though floating point multiplication is somewhat slower (up to 5 times), it will not make any difference in your program if you don't only do simple arithmetic operations. So in most cases loss of precision in FP values creates more problems than it's speed.<br/>
</code></td></tr></table>
<!-- end of the code -->
<p>&nbsp;</p>
<p>Additionally, <a href="http://www.cplusplus.com/user/MiiNiPaa">MiiNiPaa</a> replied with a link to 
<a href="http://stackoverflow.com/questions/5069489/performance-of-built-in-types-char-vs-short-vs-int-vs-float-vs-double">stackoverflow.com</a>.
The reactions varied from repeating that in general integer operations are faster than floating point math. 
<a href="http://stackoverflow.com/users/142434/stephen-canon">stephen canon</a> supplied a link to
<a href="http://www.agner.org/optimize">agner.com</a>, of which the article 'Optimizing software in C++: An optimization guide for Windows, Linux and Mac platforms' 
gives many pinpointers. For example, it states for integers (section 'Integer operators',page 30):</p>
<p>&nbsp;</p>
<!-- start of code -->
<table summary="Quote from 'Optimizing software in C++: An optimization guide for Windows, Linux and Mac platforms',section 'Integer operators', page 30" border = "1"><tr><td><code>
Integer operations are generally very fast. Simple integer operations such as addition, subtraction, comparison, bit operations and shift operations take only one clock cycle on most microprocessors.<br/>
Multiplication and division take longer time. Integer multiplication takes 11 clock cycles on Pentium 4 processors, and 3 - 4 clock cycles on most other microprocessors. Integer division takes 40 - 80 clock cycles, depending on the microprocessor<br/>
</code></td></tr></table>
<!-- end of the code -->
<p>&nbsp;</p>
<p>And for doubles (section 'Floating point variables and operators',page 32):</p>
<p>&nbsp;</p>
<!-- start of code -->
<table summary="Quote from 'Optimizing software in C++: An optimization guide for Windows, Linux and Mac platforms',section 7.3 'Floating point variables and operators', page 32" border = "1"><tr><td><code>
Floating point addition takes 3 - 6 clock cycles, depending on the microprocessor.
Multiplication takes 4 - 8 clock cycles. Division takes 14 - 45 clock cycles.<br/>
</code></td></tr></table>
<!-- end of the code -->
<p>&nbsp;</p>
<p>This makes me conclude that int is faster for simpler (addition, comparison) operations only.</p>
<p>&nbsp;</p>
<p>Note that the conversion between integer and double is especially costly, as <a href="http://www.agner.org/optimize">agner.com</a> the article 'Optimizing software in C++: An optimization guide for Windows, Linux and Mac platforms' 
states (section 'Float to integer conversion',page 41):</p>
<p>&nbsp;</p>
<!-- start of code -->
<table summary="Quote from 'Optimizing software in C++: An optimization guide for Windows, Linux and Mac platforms',section 'Float to integer conversion', page 41" border = "1"><tr><td><code>
Conversion of a floating point number to an integer takes a very long time unless the SSE2 or later instruction set is enabled. Typically, the conversion takes 50 - 100 clock cycles.<br/>
</code></td></tr></table>
<!-- end of the code -->
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>Conclusion</h2>
<p>&nbsp;</p>
<p>Back to the original question: Will it pay off to replace the use of doubles by a custom class using integers?</p>
<p>&nbsp;</p>
<p>As such a custom class uses two integers, my guess will be: no.</p>
<p>&nbsp;</p>
<p>To draw a conclusion, use a <a href="CppProfiler.htm">profiler</a>.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><a href="Cpp.htm">Go back to Richel Bilderbeek's C++ page</a>.</p>
<p><a href="index.htm">Go back to Richel Bilderbeek's homepage</a>.</p>
<p>&nbsp;</p>
<p><a href="http://validator.w3.org/check?uri=referer"><img src="valid-xhtml10.png" alt="Valid XHTML 1.0 Strict" height="31" width="88" /></a></p>
<p>This page has been created by the <a href="Tools.htm">tool</a> <a href="ToolCodeToHtml.htm">CodeToHtml</a></p>
</body>
</html>

